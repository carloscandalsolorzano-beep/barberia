<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reserva - Peluquería Moderna</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-white min-h-screen flex items-center justify-center p-4 font-sans">

    <div class="bg-slate-800 p-8 rounded-2xl shadow-2xl w-full max-w-md border border-slate-700">
        <h1 class="text-3xl font-black text-center mb-2 text-amber-500 uppercase tracking-widest">Barbería Elite</h1>
        <p class="text-slate-400 text-center mb-8 text-sm">Reserva tu corte de 30 min</p>

        <form id="reservaForm" class="space-y-5">
            <div>
                <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Elegir Barbero</label>
                <select id="peluquero" class="w-full bg-slate-700 border-none p-3 rounded-lg focus:ring-2 focus:ring-amber-500 outline-none">
                    <option value="will">Will</option>
                    <option value="davis">Davis</option>
                </select>
            </div>

            <div class="space-y-2">
                <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Tus Datos</label>
                <input type="text" id="nombre" placeholder="Nombre completo" class="w-full bg-slate-700 p-3 rounded-lg outline-none focus:ring-2 focus:ring-amber-500" required>
                <input type="tel" id="telefono" placeholder="Número de teléfono" class="w-full bg-slate-700 p-3 rounded-lg outline-none focus:ring-2 focus:ring-amber-500" required>
            </div>

            <div>
                <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Día de la cita</label>
                <input type="date" id="fecha" class="w-full bg-slate-700 p-3 rounded-lg outline-none focus:ring-2 focus:ring-amber-500 text-white" required>
            </div>

            <div>
                <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Horas disponibles</label>
                <select id="hora" class="w-full bg-slate-700 p-3 rounded-lg outline-none focus:ring-2 focus:ring-amber-500" required>
                    <option value="">Selecciona un día primero</option>
                </select>
            </div>

            <button type="submit" id="btn" class="w-full bg-amber-600 hover:bg-amber-500 py-4 rounded-xl font-bold transition-all shadow-lg shadow-amber-900/40 text-white active:scale-95">
                CONFIRMAR CITA
            </button>
        </form>
    </div>

    <script>
        const URL_SCRIPT = "https://script.google.com/macros/s/AKfycbw5MFIeIPyWBgkr03refFm_d4Ot_CIQh1EtKAVP46-uWTVbVNDtLOEQCF9ZmzklesxA/exec";

        const fechaInput = document.getElementById('fecha');
        const horaSelect = document.getElementById('hora');
        const peluqueroSelect = document.getElementById('peluquero');

        [fechaInput, peluqueroSelect].forEach(el => el.addEventListener('change', cargarHoras));

        async function cargarHoras() {
            if(!fechaInput.value) return;
            horaSelect.innerHTML = '<option>Consultando disponibilidad...</option>';
            
            try {
                const res = await fetch(`${URL_SCRIPT}?peluquero=${peluqueroSelect.value}&fecha=${fechaInput.value}`);
                const ocupados = await res.json();

                const dia = new Date(fechaInput.value).getUTCDay();
                let horas = [];

                if(dia >= 1 && dia <= 5) { 
                    horas = [...gen(10, 14), ...gen(16.5, 20.5)];
                } else if(dia === 6) { 
                    horas = gen(9, 14);
                }

                const libres = horas.filter(h => !ocupados.includes(h));
                horaSelect.innerHTML = libres.length ? '' : '<option disabled>Todo lleno para este día</option>';
                libres.forEach(h => {
                    const opt = document.createElement('option');
                    opt.value = h;
                    opt.textContent = h;
                    horaSelect.appendChild(opt);
                });
            } catch (error) {
                horaSelect.innerHTML = '<option disabled>Error al cargar horarios</option>';
                console.error(error);
            }
        }

        function gen(ini, fin) {
            let res = [];
            for(let m = ini*60; m < fin*60; m+=30) {
                let h = Math.floor(m/60).toString().padStart(2,'0');
                let min = (m%60).toString().padStart(2,'0');
                res.push(`${h}:${min}`);
            }
            return res;
        }

        document.getElementById('reservaForm').onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btn');
            btn.disabled = true; 
            btn.innerText = "Procesando reserva...";

            const datos = {
                peluquero: peluqueroSelect.value,
                nombre: document.getElementById('nombre').value,
                telefono: document.getElementById('telefono').value,
                fecha: fechaInput.value,
                hora: horaSelect.value
            };

            try {
                await fetch(URL_SCRIPT, { method: 'POST', body: JSON.stringify(datos) });
                alert("¡Cita confirmada! Se ha registrado en el calendario.");
                location.reload();
            } catch (err) {
                alert("Error al enviar la reserva.");
                btn.disabled = false;
                btn.innerText = "CONFIRMAR CITA";
            }
        };
    </script>
</body>
</html>
